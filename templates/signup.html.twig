<!DOCTYPE html>
<html lang="en">
{% include 'partials/head.html.twig' %}

<body>
    {% include 'partials/navbar.html.twig' %}
    <div class="container mt-5">
        <h2>{{message}}</h2>
        <div class="row">
            <div class="col-md-4 offset-md-4" action="/signup.php" method="post" novalidate>
                <form id="signup" class="mt-5">
                    <div class="mb-3">
                        <label for="username" class="form-label">Username</label>
                        <input name="username" type="text" class="form-control" id="username"
                            placeholder="Maximum 16 characters">

                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email address</label>
                        <input name="email" type="email" class="form-control" id="email" placeholder="Name@example.com">
                        <div class="invalid-feedback">
                            Please select a valid email address.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input name="password1" type="password" class="form-control" id="password"
                            placeholder="Example123!">
                        <div class="invalid-feedback">
                            Password has to be at least 10 characters.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="confirm-password" class="form-label">Confirm Password</label>
                        <input name="password2" type="password" class="form-control" id="confirm-password"
                            placeholder="Confirm your password">
                        <div class="invalid-feedback">
                            Passwords are not matching.
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Sign Up</button>
                </form>
            </div>
        </div>
    </div>
    <script>
        const form = document.querySelector("#signup")

        form.addEventListener('input', function (event) {
            const element = event.target
            const val = event.target.value
        })

        form.addEventListener('submit', function (event) {
            event.preventDefault()
            let errors = { username: 0, email: 0, password1: 0, password2: 0 }
            const data = new FormData(form)

            const password1 = data.get("password1")
            if (password1.length < 10) {
                document.querySelector("#password").classList.add("is-invalid")
                errors.password1 = 1
            }
            else {
                document.querySelector("#password").classList.remove("is-invalid")
                document.querySelector("#password").classList.add("is-valid")
                errors.password1 = 0
            }
            const password2 = data.get("password2")
            if (password2 != password1) {
                document.querySelector("#confirm-password").classList.add("is-invalid")
                errors.password2 = 1
            }
            else {
                document.querySelector("#confirm-password").classList.remove("is-invalid")
                document.querySelector("#confirm-password").classList.add("is-valid")
                errors.password2 = 0
            }
            const email = data.get("email")
            if (email.indexOf('@') == 0 ||
                email.indexOf('@') == email.length - 1 ||
                email.indexOf('@') == -1) {
                document.querySelector("#email").classList.add("is-invalid")
                errors.email = 1
            }
            else {
                document.querySelector("#email").classList.remove("is-invalid")
                document.querySelector("#email").classList.add("is-valid")
                errors.email = 0
            }
            const username = data.get("username")
            if (username.length < 3 || username.length > 16) {
                document.querySelector("#username").classList.add("is-invalid")
                errors.username = 1
            }
            else {
                document.querySelector("#username").classList.remove("is-invalid")
                document.querySelector("#username").classList.add("is-valid")
                errors.username = 0
            }
            if (errors.username == 0 &&
                errors.password1 == 0 &&
                errors.password2 == 0 &&
                errors.email == 0
            )
            {
                // form.submit()
                const url = "/signup.php"
                const request = fetch(url, {method: "POST"})
            }
        })
    </script>
</body>

</html>